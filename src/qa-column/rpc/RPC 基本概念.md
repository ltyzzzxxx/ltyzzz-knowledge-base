---
title: RPC 基本概念
---

## 问题清单

::: tip Questions
1.   **RPC 框架基本概念是什么？**

2.   **RPC 框架的代理层作用？**

3.   **RPC 框架的路由层作用？**

4.   **RPC 框架的协议层作用？**

5.   **RPC 框架的注册中心层作用？**

6.   **RPC 框架的容错层作用？**
::: 

## 问题回答

1.   **RPC 框架基本概念是什么？**
::: info Answer
  `RPC` 允许程序在不同的进程或机器之间进行通信，互相调用函数或方法，就像调用本地方法一样。

  `RPC` 框架的主要角色为：服务提供者、服务消费者与注册中心

  -   服务消费者是调用远程服务的应用程序

  -   服务提供者是提供远程服务的应用程序
  
  -   注册中心是负责管理服务地址和方法信息的中心化服务，它记录了所有可用的远程服务信息，并为客户端提供服务的地址发现功能。

  具体又可以分为以下几个核心组件：

  -   `Client`

  -   `Server`

  -   `Client Stub`：将客户端请求的参数、服务名称、服务地址进行打包，统一发送给 `server` 方

  -   `Server Stub`：服务端接收到 `Client` 发送的数据之后进行消息解包，调用本地方法

  RPC 简单调用流程为：

  1.   `Client` 调用 `Client Stub`，传入方法信息

  2.   `Client Stub` 对方法进行包装，并序列化，通过网络传输发送给 `Server Stub`

  3.   `Server Stub` 进行反序列化，获取方法参数等信息，本地调用Server中提供的方法

  4.   `Server` 执行方法后，将方法返回结果返回给 `Server Stub`

  5.   `Server Stub` 将方法返回结果进行序列化，通过网络传输发送给 `Client Stub`

  6.   `Client Stub` 进行反序列化，并传递给 `Client`，得到最终结果
:::

2.   **RPC 框架的代理层作用？**
::: info Answer
  代理模式主要是为了屏蔽调用远程方法时，底层的建立网络连接、序列化、发送数据、获取返回结果等细节操作，使得远程调用看起来像是本地方法调用一样

  代理模式的主要优点有：

  -   代理模式在客户端与目标对象之间起到一个中介作用和保护目标对象的作用；

  -   代理对象可以扩展目标对象的功能；

  -   代理模式能将客户端与目标对象分离，在一定程度上降低了系统的耦合度，增加了程序的可扩展性。
:::

3.   **RPC 框架的路由层作用？**
::: info Answer
  路由层解决的问题为：**当目标服务众多的时候，客户端需要如何确定最终请求的服务提供者**

  通过路由层，去匹配对应的 `Provider` 服务提供者
:::

4.   **RPC 框架的协议层作用？**
::: info Answer
  -   使用 RPC 框架进行远程调用的时候，需要对数据信息进行统一的包装和组织，最终才能将其发送到目标机器并且被目标机器接收解析

      因此对于数据的各种序列化、反序列化，协议的组装我们统一可以封装在协议层中进行实现

  -   可以帮助开发者屏蔽网络传输和数据编解码等底层细节，使得开发者只需要关注业务逻辑的实现
:::

5.   **RPC 框架的注册中心层作用？**
::: info Answer
  -   客户端在进行远程调用时，需要获取到远程服务的各种信息，这些信息一般存储在注册中心中

  -   服务发现：客户端需要订阅注册中心。在需要远程调用时，从注册中心中获取信息，然后进行方法调用

  -   服务注册：服务提供者将地址、接口、分组等信息存放在注册中心模块，当服务上线、下线均会通知注册中心

  -   服务管理：提供服务的上下线管理、服务配置管理、服务健康检查等功能，以保证服务的可靠性和稳定性
:::

6.   **RPC 框架的容错层作用？**
::: info Answer
  -   超时控制：通过设置超时时间来避免因服务端响应慢或网络等原因导致客户端等待时间过长的问题

  -   重试机制：当 `RPC` 调用失败时，可以通过自动重试的方式进行容错处理，增加调用的成功率
  
  -   异常处理：对于 `RPC` 调用过程中出现的异常，进行捕捉处理
:::